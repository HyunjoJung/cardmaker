name: Build .NET Windows Application

on:
  push:
    branches: [ main ]
    paths: 
      - '**.cs'
      - '**.csproj'
      - '.github/workflows/build-dotnet.yml'
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'
        
    - name: Restore dependencies
      run: dotnet restore BusinessCardMaker.csproj
      
    - name: Build application
      run: dotnet build BusinessCardMaker.csproj -c Release --no-restore
      
    - name: Publish single file executable
      run: |
        dotnet publish BusinessCardMaker.csproj `
          -c Release `
          --self-contained true `
          -r win-x64 `
          -p:PublishSingleFile=true `
          -p:IncludeNativeLibrariesForSelfExtract=true `
          -p:EnableCompressionInSingleFile=true `
          -o dist
          
    - name: Upload executable
      uses: actions/upload-artifact@v4
      with:
        name: BusinessCardMaker-Windows
        path: dist/BusinessCardMaker.exe
        retention-days: 30
        
    - name: Create Release (on main branch)
      if: github.ref == 'refs/heads/main'
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v1.0.${{ github.run_number }}
        name: Business Card Maker v1.0.${{ github.run_number }}
        body: |
          ğŸ¯ **C# .NET Windows ëª…í•¨ ìë™í™” ì‹œìŠ¤í…œ**
          
          ### âœ¨ ì£¼ìš” ê¸°ëŠ¥
          - Microsoft OpenXML SDK ê¸°ë°˜ ì •í™•í•œ PowerPoint ì¡°ì‘
          - COM ì˜ì¡´ì„± ì—†ëŠ” ì•ˆì •ì ì¸ ì‹¤í–‰
          - SQLite ë°ì´í„°ë² ì´ìŠ¤ í†µí•© ê´€ë¦¬
          - Excel XML íŒŒì¼ ì§ì ‘ íŒŒì‹±
          - PPT + PDF ë™ì‹œ ìƒì„± (LibreOffice í•„ìš”)
          - ë‹¨ì¼ exe ë°°í¬ (ëª¨ë“  ì˜ì¡´ì„± í¬í•¨)
          
          ### ğŸš€ ì‚¬ìš©ë²•
          1. `BusinessCardMaker.exe` ë‹¤ìš´ë¡œë“œ
          2. ì‹¤í–‰ (ì¶”ê°€ ì„¤ì¹˜ ë¶ˆí•„ìš”)
          3. Excel XML íŒŒì¼ ë¡œë“œ
          4. ëª…í•¨ ìƒì„±!
          
          ### ğŸ“‹ ìš”êµ¬ì‚¬í•­
          - Windows 10/11 (x64)
          - LibreOffice (PDF ìƒì„±ìš©, ì„ íƒì‚¬í•­)
          
          **íŒŒì¼ í¬ê¸°**: ~80MB (ëª¨ë“  .NET ëŸ°íƒ€ì„ í¬í•¨)
        files: dist/BusinessCardMaker.exe
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}